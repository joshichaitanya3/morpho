// CG2 FunctionSpace in three dimensions

import meshtools 

var cube = [ [0,0,0], [1,0,0], [0,1,0], [1,1,0],
             [0,0,1], [1,0,1], [0,1,1], [1,1,1] ]

var pts = []
for (x in cube) pts.append(Matrix(x))

var m = DelaunayMesh(pts)
m.addgrade(1)

var fe = FiniteElementSpace("CG2", grade=3)

var f = Field(m, fn (x,y,z) x*y*z, finiteelementspace=fe)
print f.shape() // expect: [ 1, 1, 0, 0 ]

print abs(VolumeIntegral(fn (x, q) q, f, method={}).total(m) - 0.125) < 1e-8
// expect: true 

var g = Field(m, fn (x,y,z) x^2*(y+z), finiteelementspace=fe)
print abs(VolumeIntegral(fn (x, q) q, g, method={}).total(m) - 1/3) < 1e-8
// expect: true 

var h = Field(m, fn (x,y,z) z^3-x^2-y, finiteelementspace=fe)
print abs(VolumeIntegral(fn (x, q) q, h, method={}).total(m) - (-7/12)) < 1e-8
// expect: true 
