// CG2 FunctionSpace in three dimensions

import meshtools 

var cube = [ [0,0,0], [1,0,0], [0,1,0], [1,1,0],
             [0,0,1], [1,0,1], [0,1,1], [1,1,1] ]

var pts = []
for (x in cube) pts.append(Matrix(x))

var m = DelaunayMesh(pts)
m.addgrade(1)

var fe = FiniteElementSpace("CG2", grade=3)

fn normsq(x, q) {
    var g = grad(q)
    return g.norm()^2
}

var f = Field(m, fn (x,y,z) x*y + y*z + z*x, finiteelementspace=fe)
print abs(VolumeIntegral(normsq, f, method={}).total(m) - 7/2) < 1e-6
// expect: true 

f = Field(m, fn (x,y,z) x^2 - y^2 + 2*x*y, finiteelementspace=fe)
print abs(VolumeIntegral(normsq, f, method={}).total(m) - 16/3) < 1e-6
// expect: true 

f = Field(m, fn (x,y,z) x + y + z, finiteelementspace=fe)
print abs(VolumeIntegral(normsq, f, method={}).total(m) - 3) < 1e-6
// expect: true 
